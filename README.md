# ‚öΩ Football Data Analysis ‚Äî dbt + ClickHouse

**–ü—Ä–æ–µ–∫—Ç:** –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –ë—É–Ω–¥–µ—Å–ª–∏–≥–∏  
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** ClickHouse ‚Ä¢ dbt ‚Ä¢ SQL ‚Ä¢ Python  
**–ê–≤—Ç–æ—Ä:** Ramilia Imankulova ‚Äî Junior Data Analyst

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ª–æ—è –¥–∞–Ω–Ω—ã—Ö (Data Mart)** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –ë—É–Ω–¥–µ—Å–ª–∏–≥–∏ (–∏—Å—Ç–æ—á–Ω–∏–∫: Kaggle).

–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —ç—Ç–∞–ø—ã –æ—á–∏—Å—Ç–∫–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (ELT-–ø–æ–¥—Ö–æ–¥) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **dbt (Data Build Tool)**, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –∫ **ClickHouse** ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–ª–æ–Ω–æ—á–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ö–ª—é—á–µ–≤–∞—è —Ü–µ–ª—å:** –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ 12 –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–≤–æ–ø—Ä–æ—Å–æ–≤, –∫–∞—Å–∞—é—â–∏—Ö—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–º–∞–Ω–¥.

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å **–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥** (`models/`) –∏ **—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** (`.csv` —Ñ–∞–π–ª—ã):
football-data-analysis-dbt-clickhouse/ ‚îú‚îÄ‚îÄ dbt_project/ ‚îÇ ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ analysis/ # 12 SQL-–º–æ–¥–µ–ª–µ–π (–ö–æ–¥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π) ‚îú‚îÄ‚îÄ 1_rep_top_3_defense.csv <-- –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞! ‚îú‚îÄ‚îÄ ... (10 –¥—Ä—É–≥–∏—Ö CSV-—Ñ–∞–π–ª–æ–≤) ‚îú‚îÄ‚îÄ 12_rep_top3_value_dominance.csv

## üß© –û–ø–∏—Å–∞–Ω–∏–µ 12 –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ú–æ–¥–µ–ª–µ–π (Data Mart)

–§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö 12 –º–æ–¥–µ–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≤–∏–¥–µ CSV-—Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ.

|   ‚Ññ    | –§–∞–π–ª                              | –ó–∞–¥–∞—á–∞                                                                                                   | –ö–ª—é—á–µ–≤–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è                 |
| :----: | :-------------------------------- | :------------------------------------------------------------------------------------------------------- | :------------------------------------------------- |
| **1**  | `1_rep_top_3_defense.sql`         | –í—ã–≤–µ—Å—Ç–∏ **—Ç–æ–ø-3 –∫–ª—É–±–∞ —Å —Å–∞–º–æ–π –¥–æ—Ä–æ–≥–æ–π –∑–∞—â–∏—Ç–æ–π**.                                                         | `SUM` & `GROUP BY`                                 |
| **2**  | `2_rep_joined_after_count.sql`    | –ü–æ—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–¥–ø–∏—Å–∞–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –∫–ª—É–±–æ–º **–ø–æ—Å–ª–µ** —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.                        | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (`COUNT` over Partition)       |
| **3**  | `3_rep_french_value_gt_5m.sql`    | –í—ã–±—Ä–∞—Ç—å –∫–ª—É–±—ã, –≥–¥–µ —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å **—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤—ã—à–µ ‚Ç¨5 –º–ª–Ω**.                                | `AVG`, `HAVING`                                    |
| **4**  | `4_rep_german_share_gt_90.sql`    | –í—ã–±—Ä–∞—Ç—å –∫–ª—É–±—ã, –≥–¥–µ **–¥–æ–ª—è –Ω–µ–º–µ—Ü–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤—ã—à–µ 90%**.                                                   | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`SUM` —Å `CASE`)                     |
| **5**  | `5_rep_most_expensive_by_age.sql` | –í—ã–±—Ä–∞—Ç—å **—Å–∞–º–æ–≥–æ –¥–æ—Ä–æ–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤ —Å–≤–æ—ë–º –≤–æ–∑—Ä–∞—Å—Ç–µ**.                                                     | **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** (`ROW_NUMBER()` —Å `PARTITION BY`) |
| **6**  | `6_rep_value_gt_1_5x_avg_pos.sql` | –í—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤, —á—å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å **–≤ 1.5 —Ä–∞–∑–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π** –ø–æ –∏—Ö –ø–æ–∑–∏—Ü–∏–∏.                                | **–°–∞–º–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (Self-Join)                     |
| **7**  | `7_rep_hardest_position.sql`      | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ **—Å–ª–æ–∂–Ω–µ–µ –≤—Å–µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç**.                                        | `COUNT` + –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è                               |
| **8**  | `8_rep_earliest_5_contracts.sql`  | –ù–∞–π—Ç–∏ –∫–ª—É–±, –≥–¥–µ **—É 5 –∏–≥—Ä–æ–∫–æ–≤ —Ä–∞–Ω—å—à–µ –≤—Å–µ—Ö –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**.                                     | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (`ROW_NUMBER()` –ø–æ –¥–∞—Ç–µ)       |
| **9**  | `9_rep_peak_value_age.sql`        | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å **–≤–æ–∑—Ä–∞—Å—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –∏–≥—Ä–æ–∫–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ø–∏–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏**.                            | `AVG` –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É                                  |
| **10** | `10_rep_most_played_together.sql` | –ù–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å **—Å–∞–º—ã–º —Å—ã–≥—Ä–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–∞–≤–æ–º**.                                                            | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** + ClickHouse `dateDiff`        |
| **11** | `11_rep_teams_with_namesakes.sql` | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã, –≥–¥–µ –µ—Å—Ç—å **—Ç—ë–∑–∫–∏**.                                                                  | `GROUP BY` –ø–æ `first_name` + `HAVING`              |
| **12** | `12_rep_top3_value_dominance.sql` | –ù–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—ã, –≥–¥–µ **—Ç–æ–ø-3 –∏–≥—Ä–æ–∫–∞** –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–∏–º–∞—é—Ç $\mathbf{\ge 50\%}$ **–æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–ª—É–±–∞**. | **–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è —Å—É–º–º–∞** (`SUM` over Order)          |

---

## üöÄ –†–µ–∑—é–º–µ –ü—Ä–æ–µ–∫—Ç–∞ –∏ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –í–∫–ª–∞–¥

–ü—Ä–æ–µ–∫—Ç ¬´Football Data Analysis ‚Äî dbt + ClickHouse¬ª –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ (pipeline) —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: –ü—Ä–æ–µ–∫—Ç–æ–º –±—ã–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ 12 —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø–µ—Ä–µ–¥–æ–≤—ã–µ SQL-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–µ —Å—É–º–º—ã –∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á.

–°–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç—å (dbt): –° –ø–æ–º–æ—â—å—é dbt –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–∞—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª–µ–≥–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ª–æ—è.

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –í–ª–∞–¥–µ–Ω–∏–µ ClickHouse: –£—Å–ø–µ—à–Ω–æ —Ä–µ—à–µ–Ω –≤—ã–∑–æ–≤ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é dbt –Ω–∞ ClickHouse, –≤–∫–ª—é—á–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥ –∏–º–µ–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º arrayElement(..., -1)).

–ö–∞—á–µ—Å—Ç–≤–æ –∏ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –î–∞–Ω–Ω—ã—Ö: –ë—ã–ª —Å–æ–∑–¥–∞–Ω —Å–ª–æ–π Staging (clean_players) –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∞ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω—ã–º –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ–º –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (dbt test).

–§–∏–Ω–∞–ª—å–Ω–∞—è –î–æ—Å—Ç–∞–≤–∫–∞ –î–∞–Ω–Ω—ã—Ö: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö 12 —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –≤ —Ñ–æ—Ä–º–∞—Ç CSV, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—É—é –∏ –ø—Ä—è–º—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã BI (Business Intelligence).
