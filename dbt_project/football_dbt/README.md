# ‚öΩ Football Data Analysis ‚Äî dbt + ClickHouse

**–ü—Ä–æ–µ–∫—Ç:** –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –ë—É–Ω–¥–µ—Å–ª–∏–≥–∏  
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** ClickHouse ‚Ä¢ dbt ‚Ä¢ SQL ‚Ä¢ Python  
**–ê–≤—Ç–æ—Ä:** Ramilia Imankulova ‚Äî Junior Data Analyst

---

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ª–æ—è –¥–∞–Ω–Ω—ã—Ö (Data Mart)** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ –ë—É–Ω–¥–µ—Å–ª–∏–≥–∏ (–∏—Å—Ç–æ—á–Ω–∏–∫: Kaggle).

–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —ç—Ç–∞–ø—ã –æ—á–∏—Å—Ç–∫–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (ELT-–ø–æ–¥—Ö–æ–¥) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **dbt (Data Build Tool)**, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –∫ **ClickHouse** ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–ª–æ–Ω–æ—á–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ö–ª—é—á–µ–≤–∞—è —Ü–µ–ª—å:** –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ 12 –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–≤–æ–ø—Ä–æ—Å–æ–≤, –∫–∞—Å–∞—é—â–∏—Ö—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–º–∞–Ω–¥.

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

football-data-analysis-dbt-clickhouse/ ‚îú‚îÄ‚îÄ data/ # –ò—Å—Ö–æ–¥–Ω—ã–µ CSV-—Ñ–∞–π–ª—ã ‚îú‚îÄ‚îÄ dbt_project/football_dbt/

‚îÇ ‚îú‚îÄ‚îÄ models/

‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ staging/ # –û—á–∏—â–µ–Ω–Ω—ã–µ/–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (Clean/Staging) ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ analysis/ # 12 –§–∏–Ω–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (Data Mart) ‚îÇ ‚îú‚îÄ‚îÄ dbt_project.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è dbt-–ø—Ä–æ–µ–∫—Ç–∞ ‚îî‚îÄ‚îÄ README.md

## üß© –û–ø–∏—Å–∞–Ω–∏–µ 12 –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π (Data Mart)

–§–∏–Ω–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø–∞–ø–∫–µ `models/analysis/`:

|   ‚Ññ    | –§–∞–π–ª                              | –ó–∞–¥–∞—á–∞                                                                                                   | –ö–ª—é—á–µ–≤–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è                 |
| :----: | :-------------------------------- | :------------------------------------------------------------------------------------------------------- | :------------------------------------------------- |
| **1**  | `1_rep_top_3_defense.sql`         | –í—ã–≤–µ—Å—Ç–∏ **—Ç–æ–ø-3 –∫–ª—É–±–∞ —Å —Å–∞–º–æ–π –¥–æ—Ä–æ–≥–æ–π –∑–∞—â–∏—Ç–æ–π** (`Defender-*`).                                          | `SUM` & `GROUP BY`                                 |
| **2**  | `2_rep_joined_after_count.sql`    | –ü–æ—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ–¥–ø–∏—Å–∞–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –∫–ª—É–±–æ–º **–ø–æ—Å–ª–µ** —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞.                        | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (`COUNT` over Partition)       |
| **3**  | `3_rep_french_value_gt_5m.sql`    | –í—ã–±—Ä–∞—Ç—å –∫–ª—É–±—ã, –≥–¥–µ —Å—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å **—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤—ã—à–µ ‚Ç¨5 –º–ª–Ω**.                                | `AVG`, `HAVING`                                    |
| **4**  | `4_rep_german_share_gt_90.sql`    | –í—ã–±—Ä–∞—Ç—å –∫–ª—É–±—ã, –≥–¥–µ **–¥–æ–ª—è –Ω–µ–º–µ—Ü–∫–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤—ã—à–µ 90%**.                                                   | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`SUM` —Å `CASE`)                     |
| **5**  | `5_rep_most_expensive_by_age.sql` | –í—ã–±—Ä–∞—Ç—å **—Å–∞–º–æ–≥–æ –¥–æ—Ä–æ–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤ —Å–≤–æ—ë–º –≤–æ–∑—Ä–∞—Å—Ç–µ** (–∏–º—è + —Å—Ç–æ–∏–º–æ—Å—Ç—å).                                   | **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** (`ROW_NUMBER()` —Å `PARTITION BY`) |
| **6**  | `6_rep_value_gt_1_5x_avg_pos.sql` | –í—ã–±—Ä–∞—Ç—å –∏–≥—Ä–æ–∫–æ–≤, —á—å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å **–≤ 1.5 —Ä–∞–∑–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π** –ø–æ –∏—Ö –ø–æ–∑–∏—Ü–∏–∏.                                | **–°–∞–º–æ—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (Self-Join) –∏–ª–∏ CTE             |
| **7**  | `7_rep_hardest_position.sql`      | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ **—Å–ª–æ–∂–Ω–µ–µ –≤—Å–µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç** (–ø–æ–¥—Å—á–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤).                      | `COUNT` + –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è                               |
| **8**  | `8_rep_earliest_5_contracts.sql`  | –ù–∞–π—Ç–∏ –∫–ª—É–±, –≥–¥–µ **—É 5 –∏–≥—Ä–æ–∫–æ–≤ —Ä–∞–Ω—å—à–µ –≤—Å–µ—Ö –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**.                                     | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (`ROW_NUMBER()` –ø–æ –¥–∞—Ç–µ)       |
| **9**  | `9_rep_peak_value_age.sql`        | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å **–≤–æ–∑—Ä–∞—Å—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –∏–≥—Ä–æ–∫–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –¥–æ—Å—Ç–∏–≥–∞—é—Ç –ø–∏–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏**.                            | `AVG` –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É                                  |
| **10** | `10_rep_most_played_together.sql` | –ù–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å **—Å–∞–º—ã–º —Å—ã–≥—Ä–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–∞–≤–æ–º** (–¥–æ–ª—å—à–µ –≤—Å–µ–≥–æ –∏–≥—Ä–∞—é—Ç –≤–º–µ—Å—Ç–µ).                               | **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** + ClickHouse `dateDiff`        |
| **11** | `11_rep_teams_with_namesakes.sql` | –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã, –≥–¥–µ –µ—Å—Ç—å **—Ç—ë–∑–∫–∏** (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤).                                       | `GROUP BY` –ø–æ `first_name` + `HAVING`              |
| **12** | `12_rep_top3_value_dominance.sql` | –ù–∞–π—Ç–∏ –∫–æ–º–∞–Ω–¥—ã, –≥–¥–µ **—Ç–æ–ø-3 –∏–≥—Ä–æ–∫–∞** –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–∏–º–∞—é—Ç $\mathbf{\ge 50\%}$ **–æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–ª—É–±–∞**. | **–ö—É–º—É–ª—è—Ç–∏–≤–Ω–∞—è —Å—É–º–º–∞** (`SUM` over Order)          |

---

## üöÄ –†–µ–∑—é–º–µ –∏ –ù–∞–≤—ã–∫–∏

–ü—Ä–æ–µ–∫—Ç ¬´Football Data Analysis ‚Äî dbt + ClickHouse¬ª –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã:

1.  **–í–ª–∞–¥–µ–Ω–∏–µ SQL –∏ dbt:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∞–≥—Ä–µ–≥–∞—Ü–∏–π –∏ –¥–∂–æ–π–Ω–æ–≤** –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á.
2.  **–†–∞–±–æ—Ç–∞ —Å ClickHouse:** –£—Å–ø–µ—à–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ dbt –Ω–∞ ClickHouse, –≤–∫–ª—é—á–∞—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, **–ø–∞—Ä—Å–∏–Ω–≥ –∏–º–µ–Ω** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `arrayElement(..., -1)`).
3.  **Data Quality:** –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–æ–π Staging –∏ —É—Å–ø–µ—à–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (`dbt test`).
